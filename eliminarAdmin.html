<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/stylesAdmin.css">
    <link rel="icon" type="image" href="img/favicon/cara-de-gato-sin-boca.png">
    <title>Duque's Music</title>
</head>
<body>
    <header>
            
        <div class="div-header-p-img">
            <img class="header-img" src="img/favicon/cara-de-gato-feliz.png" alt="">
            <p class="header-p">Duque's <span class="header-p-span">Music</span> / Administrador</p>
        </div>
        
        <nav>    
            <div class="nav-div">
                <a class="nav-a" href="verAdmin.html">Ver</a>
                <a class="nav-a" href="consultarAdmin.html">Consultar</a>
                <a class="nav-a" href="crearAdmin.html">Crear</a>
                <a class="nav-a" href="modificarAdmin.html">Modificar</a>
                <a class="nav-a" href="eliminarAdmin.html">Eliminar</a>
            </div>
        </nav>

    </header>
    <main>
        <h1>Eliminar producto por id</h1>
        <hr>
        <br>

        <form id="getProduct-form">
                <label for="idProd">Id del producto</label>
                <input type="number" name="idProd" id="IdProd" required>

                <input class="boton" type="submit" value="Consultar producto">
            </form>
            
            <div id="lista-productos">
                
            </div>

    </main>
    <script>
        let url = "http://localhost:3000/api/products";
        let getProduct_form = document.getElementById("getProduct-form");
        let listaProductos = document.getElementById("lista-productos");


        getProduct_form.addEventListener("submit", async (event) => {
            event.preventDefault();
            
            let formData = new FormData(event.target); //form data
            
            let data = Object.fromEntries(formData.entries()); //objeto
                            
            let idProd = data.idProd;
                            
            try {
                let repuesta = await fetch(`${url}/${idProd}`);
                
                let datos = await repuesta.json();

                let producto = datos.payload[0];
                
                let htmlProducto = 
                `
                <ul class="ul-admin">
                    <li class="li-listados">
                        <img src="${producto.imagen}" alt="${producto.titulo}">
                        <p>Id: ${producto.id} | Nombre: ${producto.titulo} | Precio: $${producto.precio}</p>
                    </li>
                    <li>
                        <input type="button" id="eliminar_boton" value="Eliminar producto"
                    </li>
                </ul>
                `;

                listaProductos.innerHTML = htmlProducto;
            
                let eliminar_boton = document.getElementById("eliminar_boton")

                eliminar_boton.addEventListener("click", event => {
                    event.stopPropagation();
                    let confirmacion = confirm("Â¿Quieres eliminar este producto?")
                    if(!confirmacion) {
                        alert("Eliminacion cancelada");
                    } else {
                        eliminarProducto(idProd);
                    }
                });

                async function eliminarProducto(id) {
                    console.log("eliminado: ", id);
                    try {
                        let respuesta = await fetch(`${url}/${id}`, {
                            method: "DELETE"
                        });

                        let resultado = await respuesta.json();

                        if(respuesta.ok){
                            alert(resultado.message);

                            listaProductos.innerHTML = "";
                        }
                    
                    } catch (error) {
                        console.error("Error en la solicitud DELETE: ", error)
                        alert("Ocurrio un error al eliminar un producto")
                    }
                    
                }



            } catch (error) {
                console.log(error); 
            }
                
            })




    </script>

</body>
</html>