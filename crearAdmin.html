<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/stylesAdmin.css">
        <link rel="icon" type="image" href="img/favicon/cara-de-gato-sin-boca.png">
        <title>Duque's Music</title>
    </head>

    <body>
        <header>
                
                <div class="div-header-p-img">
                    <img class="header-img" src="img/favicon/cara-de-gato-feliz.png" alt="">
                    <p class="header-p">Duque's <span class="header-p-span">Music</span> / Administrador</p>
                </div>
                
                <nav>    
                    <div class="nav-div">
                        <a class="nav-a" href="verAdmin.html">Ver</a>
                        <a class="nav-a" href="consultarAdmin.html">Consultar</a>
                        <a class="nav-a" href="crearAdmin.html">Crear</a>
                        <a class="nav-a" href="modificarAdmin.html">Modificar</a>
                        <a class="nav-a" href="eliminarAdmin.html">Eliminar</a>
                    </div>
                </nav>

        </header>

        <main>
            <h1>Crear producto</h1>
            <hr>
            <br>
            
            <!-- Formulario que va a enviar nuestros datos al endpoint -->
            
            <form id="crear-productos">
                <label for="tituloProd">Titulo</label>
                <input type="text" name="titulo" id="tituloProd" required>

                <label for="tipoProd">Tipo</label>
                <select name="tipo" id="tipoProd">
                    <option value="Vinilo">Vinilo</option>
                    <option value="Cd">Cd</option>
                    <option value="Cassette">Cassette</option>
                </select>
                
                <label for="generoProd">Genero</label>
                <input type="text" name="genero" id="generoProd" required>
                
                <label for="autorProd">Autor</label>
                <input type="text" name="autor" id="autorProd" required>

                <label for="precioProd">Precio</label>
                <input type="number" name="precio" id="precioProd" required>
                
                <label for="imagenProd">Imagen</label>
                <input type="text" name="imagen" id="imagenProd" required>

                <input type="submit" value="Crear producto">
            </form>

            <div id="contenedor-productos"></div>

        </main>
        
        <script>
            let contenedorProductos = document.getElementById("contenedor-productos");
            let crearProductos = document.getElementById("crear-productos");

            let url = "http://localhost:3000/api/products";

            crearProductos.addEventListener("submit", async (event) => {
                event.preventDefault();
                
                let formData = new FormData(event.target);

                let data = Object.fromEntries(formData.entries());
                
                console.log(data);
                
                try {
                    let respuesta = await fetch(url, { 
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                }); 

                let resultado = await respuesta.json();
                if (respuesta.ok) {
                    alert(`Producto creado con exito con ID: ${resultado.productId}`)
                } else {
                    alert(`Error en la creacion de producto: ${resultado.message}`)
                }

                } catch(error) {
                    console.error("Error al enviar los datos: ", error);
                    alert("Error al procesar los datos")
                }
            });
        </script>

    </body>
</html>