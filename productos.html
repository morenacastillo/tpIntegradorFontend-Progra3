
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="icon" type="image" href="img/favicon/cara-de-gato-sin-boca.png">
        <title>Duque's Music</title>
    </head>

    <body>
        <header>
            <div class="div-header-p-img">
                <img class="header-img" src="img/favicon/cara-de-gato-feliz.png" alt="">
                <p class="header-p">Duque's <span class="header-p-span">Music</span></p>
            </div>

            <div class="div-buscador">
                <input type="search" id="buscador-productos" placeholder="Buscar productos...">
            </div>
            
            <nav>    
                <div class="nav-div">
                    <a class="nav-a" href="inicio.html">Inicio</a>
                    <a class="nav-a" href="productos.html">Productos</a>
                    <a class="nav-a" href="carrito.html">Carrito</a>
                </div>
            </nav>
        </header>

        <main>
            <h1>Lista de productos</h1>
            <hr>
            <div id="contenedor-productos">
                
            </div>
        </main>
        
        <footer>
            <p>Emiliano David Centurion - Morena Castillo</p>
        </footer>
        
        <script>
            const contenedorProductos = document.getElementById("contenedor-productos");
            const barraBusqueda = document.getElementById("buscador-productos")
            const productos = []
            
            barraBusqueda.addEventListener("input", buscarProductos);

            async function obtenerProductos() {
                try {
                    let respuesta = await fetch("http://localhost:3000/api/products");
                    let data = await respuesta.json();
                    if(respuesta.ok) {
                        productos.length = 0;              
                        productos.push(...data.payload);
                        mostrarProductos(productos);
                    } else {
                        alert("Error obteniendo productos")
                    }


                } catch (error) {
                    console.error(error);
                }
            }

            function mostrarProductos(productos) {
                let htmlProductos = "";
                productos.forEach(prod => {
                    htmlProductos += `
                        <div class="card-producto">
                            <img src="${prod.imagen}" alt="${prod.titulo}">
                            <h3>${prod.titulo}</h5>
                            <p>$${prod.precio}</p>
                        </div>
                    `;

                    contenedorProductos.innerHTML = htmlProductos;
                })
            }

            function buscarProductos(){
                let textoBusqueda = barraBusqueda.value.toLowerCase();
                if (textoBusqueda === "") {
                    mostrarProductos(productos);
                    return;
                }
                const productosFiltrados = productos.filter(prod => {
                    // defensivo: chequeamos que exista titulo
                    return prod.titulo && prod.titulo.toLowerCase().includes(textoBusqueda);
                });

                mostrarProductos(productosFiltrados);
                }


            

            function init() {
                obtenerProductos();
            }
            init();
        </script>

    </body>
</html>