<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/stylesAdmin.css">
        <link rel="icon" type="image" href="img/favicon/cara-de-gato-sin-boca.png">
        <script defer src="js/index.js"></script>
        <title>Duque's Music</title>
    </head>

    <body>

        <header>
            
            <div class="div-header-p-img">
                <img class="header-img" src="img/favicon/cara-de-gato-feliz.png" alt="">
                <p class="header-p">Duque's <span class="header-p-span">Music</span> / Administrador</p>
            </div>
            
            <nav>    
                <div class="nav-div">
                    <a class="nav-a" href="verAdmin.html">Ver</a>
                    <a class="nav-a" href="consultarAdmin.html">Consultar</a>
                    <a class="nav-a" href="crearAdmin.html">Crear</a>
                    <a class="nav-a" href="modificarAdmin.html">Modificar</a>
                    <a class="nav-a" href="eliminarAdmin.html">Eliminar</a>
                </div>
            </nav>

        </header>

        <main>
            <h1>Consultar producto por id</h1>
            <hr>
            <br>
            
            <form id="getProduct-form">
                <label for="idProd">Id del producto</label>
                <input type="number" name="idProd" id="IdProd" required>

                <input class="boton" type="submit" value="Consultar producto">
            </form>
            
            <div id="lista-productos">
                
            </div>
            
        </main> 

        <script>
            let getProduct_form = document.getElementById("getProduct-form");
            let listaProductos = document.getElementById("lista-productos");
            let url = "http://localhost:3000/api/products";

            getProduct_form.addEventListener("submit", async (event) => {
                event.preventDefault();
                
                let formData = new FormData(event.target); //form data
                
                let data = Object.fromEntries(formData.entries()); //objeto
                                
                let idProd = data.idProd;
                                
                try {
                    let respuesta = await fetch(`${url}/${idProd}`);
                    
                    let datos = await respuesta.json();

                    if(respuesta.ok) {
                        let producto = datos.payload[0];
                        
                        mostrarProducto(producto);

                    } else {
                        console.error(datos.message)
                        mostrarError(datos.message)
                    }
                
                } catch (error) {
                    console.log(error); 
                }
                
            });

            function mostrarProducto (producto){
                let htmlProducto = 
                        `
                        <ul class="ul-admin">
                            <li class="li-listados">
                                <img src="${producto.imagen}" alt="${producto.titulo}">
                                <p>Id: ${producto.id} | Nombre: ${producto.titulo} | Precio: $${producto.precio}</p>
                            </li>
                        </ul>
                        `;
    
                listaProductos.innerHTML = htmlProducto;
            }

            function mostrarError(error){
                let htmlError = `
                <li class="mensaje-error">
                    <p>
                        <strong>Error:</strong>
                        <span>${error}</span>
                    </p>
                </li>
                `  
                listaProductos.innerHTML = htmlError;
            }

        </script>
    </body>
</html>